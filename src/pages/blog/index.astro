---
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import FormattedDate from "../../components/FormattedDate.astro";
import Header from "../../components/Header.svelte";
import { SITE_TITLE } from "../../consts";

const posts = (await getCollection("blog")).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const pageDescription = "Writing on engineering, projects, data, and experiments.";
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`Blog | ${SITE_TITLE}`} description={pageDescription} />
	</head>
	<body class="bg-slate-900 text-slate-200 flex flex-col min-h-screen">
		<Header client:load currentPath={Astro.url.pathname} />
		<main class="flex-1">
			<div class="max-w-4xl mx-auto px-6 pt-36 pb-20">
				<h1 class="text-5xl mb-4 flex items-center gap-3">
					<span class="text-teal-500/80">&#47;&#47;</span> Blog
				</h1>
				<p class="text-slate-300 text-lg mb-16 max-w-2xl leading-relaxed">{pageDescription}</p>

				<h2 class="text-3xl mb-8 flex items-center gap-3">
					<span class="text-teal-500/80">&#47;&#47;</span> Latest posts
				</h2>

				{
					posts.length === 0 ? (
						<p class="text-slate-400">No posts published yet.</p>
					) : (
						<ul class="space-y-10">
							{posts.map((post) => (
								<li>
									<a
										href={`/blog/${post.id}/`}
										class="group block border-l-2 border-teal-500/30 pl-6 hover:border-teal-500/60 transition-colors duration-300"
									>
										<p class="text-teal-300/70 text-sm mb-1">
											<FormattedDate date={post.data.pubDate} />
										</p>
										<h3 class="text-2xl text-slate-50/90 group-hover:text-teal-300/90 transition-colors duration-300 mb-2">
											{post.data.title}
										</h3>
										<p class="text-slate-300 leading-relaxed">{post.data.description}</p>
									</a>
								</li>
							))}
						</ul>
					)
				}
			</div>
		</main>
		<Footer />
	</body>
</html>
